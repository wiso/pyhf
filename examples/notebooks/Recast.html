

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reinterpreting by patching an existing HistFactory pdf spec &mdash; pyhf 0.0.4 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.2/gh-fork-ribbon.min.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ShapeFactor" href="ShapeFactor.html" />
    <link rel="prev" title="Binned HEP Statistical Analysis in Python" href="binderexample/StatisticalAnalysis.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pyhf
          

          
          </a>

          
            
            
              <div class="version">
                0.0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hello-world.html">Hello World, <code class="docutils literal notranslate"><span class="pre">pyhf</span></code> style</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderexample/StatisticalAnalysis.html">Binned HEP Statistical Analysis in Python</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Reinterpreting by patching an existing HistFactory pdf spec</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-originial-statistical-Model">The originial statistical Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Patching-the-likelihood-to-replace-the-BSM-components">Patching the likelihood to replace the BSM components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-Recasted-Result">The Recasted Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ShapeFactor.html">ShapeFactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="StatError.html">StatError</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-mxnet.html">MXNet</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-tensorflow.html">TensorFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="histogrammar.html">Histogrammar</a></li>
<li class="toctree-l2"><a class="reference internal" href="histosys-pytorch.html">HistoSys with PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="histosys.html">HistoSys</a></li>
<li class="toctree-l2"><a class="reference internal" href="importxml.html">Import XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiBinPois.html">Multi-bin Poisson</a></li>
<li class="toctree-l2"><a class="reference internal" href="multichannel-coupled-histo.html">Multibin Coupled HistoSys</a></li>
<li class="toctree-l2"><a class="reference internal" href="multichannel-coupled-normsys.html">Multibin Coupled NormSys</a></li>
<li class="toctree-l2"><a class="reference internal" href="multichannel-normsys.html">Multibin NormSys</a></li>
<li class="toctree-l2"><a class="reference internal" href="normsys.html">NormSys</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytorch_tests_onoff.html">PyTorch Tests On/Off</a></li>
<li class="toctree-l2"><a class="reference internal" href="tensorflow-limit.html">TensorFlow Limit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../talks.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Developing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyhf</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../examples.html">Examples</a> &raquo;</li>
        
      <li>Reinterpreting by patching an existing HistFactory pdf spec</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/notebooks/Recast.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Reinterpreting-by-patching-an-existing-HistFactory-pdf-spec">
<h1>Reinterpreting by patching an existing HistFactory pdf spec<a class="headerlink" href="#Reinterpreting-by-patching-an-existing-HistFactory-pdf-spec" title="Permalink to this headline">¶</a></h1>
<p>An important pattern in High-Energy physics in the reinterpretation of
analyses with respect to new signal models.</p>
<p>The main idea is that a given phase space selection (an “analysis”)
designed for some original BSM physics signal may not only be efficient
for that signal (indeed, likely it was <em>optimized</em> for that signal) but
also be reasonably efficient for other signals (albeit not optimal).
Thus, upon generating the new signal, one can pass the new signal sample
through the analysis pipeline to obtain a new estimate of its
distribution with the channels defined by the analysis.</p>
<p>The final step is then to construct a new statistical model by swapping
out the old for the new signal and evaluate new limits based on this
new, modified models.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">pyhf</span></code> this final step is demonstrated here is very easy to perform
as demonstrated in this notebook.</p>
<p>First some basic import and plotting code we will use later</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">jsonpatch</span>
<span class="kn">import</span> <span class="nn">pyhf</span>
<span class="kn">import</span> <span class="nn">pyhf.simplemodels</span>
<span class="o">%</span><span class="k">pylab</span> inline
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="n">mutests</span><span class="p">,</span> <span class="n">tests</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">):</span>
    <span class="n">cls_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">cls_exp</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mutests</span><span class="p">,</span><span class="n">cls_obs</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mutests</span><span class="p">,</span> <span class="n">cls_exp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">testmus</span><span class="p">,</span><span class="n">cls_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cls_exp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">testmus</span><span class="p">,</span><span class="n">cls_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">cls_exp</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">testmus</span><span class="p">,[</span><span class="n">test_size</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">testmus</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">invert_interval</span><span class="p">(</span><span class="n">testmus</span><span class="p">,</span> <span class="n">cls_obs</span><span class="p">,</span> <span class="n">cls_exp</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">):</span>
    <span class="n">point05cross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;exp&#39;</span><span class="p">:[],</span><span class="s1">&#39;obs&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">cls_exp_sigma</span> <span class="ow">in</span> <span class="n">cls_exp</span><span class="p">:</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">cls_exp_sigma</span>
        <span class="n">point05cross</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">test_size</span><span class="p">,</span>
                                             <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">yvals</span><span class="p">)),</span>
                                             <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">testmus</span><span class="p">))))</span>

    <span class="n">yvals</span> <span class="o">=</span> <span class="n">cls_obs</span>
    <span class="n">point05cross</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">test_size</span><span class="p">,</span>
                                    <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">yvals</span><span class="p">)),</span>
                                    <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">testmus</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">point05cross</span>
</pre></div>
</div>
</div>
<div class="section" id="The-originial-statistical-Model">
<h2>The originial statistical Model<a class="headerlink" href="#The-originial-statistical-Model" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mf">62.</span><span class="p">]</span>
<span class="n">original</span> <span class="o">=</span> <span class="n">pyhf</span><span class="o">.</span><span class="n">simplemodels</span><span class="o">.</span><span class="n">hepdata_like</span><span class="p">(</span>
    <span class="n">signal_data</span> <span class="o">=</span><span class="p">[</span><span class="mf">5.</span><span class="p">,</span><span class="mf">6.</span><span class="p">],</span>
    <span class="n">bkg_data</span>    <span class="o">=</span><span class="p">[</span><span class="mf">50.</span><span class="p">,</span><span class="mf">65.</span><span class="p">],</span>
    <span class="n">bkg_uncerts</span> <span class="o">=</span><span class="p">[</span><span class="mf">5.</span><span class="p">,</span><span class="mf">3.</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">testmus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">pyhf</span><span class="o">.</span><span class="n">runOnePoint</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">data</span> <span class="o">+</span> <span class="n">original</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auxdata</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="n">original</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suggested_init</span><span class="p">(),</span> <span class="n">original</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suggested_bounds</span><span class="p">())[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">testmus</span>
<span class="p">]</span>
<span class="n">plot_results</span><span class="p">(</span><span class="n">testmus</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/lukas/Code/pyhf/pyhf/tensor/numpy_backend.py:98: RuntimeWarning: divide by zero encountered in log
  return np.exp(n*np.log(lam)-lam-gammaln(n+1.))
/Users/lukas/Code/pyhf/pyhf/tensor/numpy_backend.py:73: RuntimeWarning: divide by zero encountered in log
  return np.log(tensor_in)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebooks_Recast_6_1.png" src="../../_images/examples_notebooks_Recast_6_1.png" />
</div>
</div>
</div>
<div class="section" id="Patching-the-likelihood-to-replace-the-BSM-components">
<h2>Patching the likelihood to replace the BSM components<a class="headerlink" href="#Patching-the-likelihood-to-replace-the-BSM-components" title="Permalink to this headline">¶</a></h2>
<p>A nice thing about being able to specify the entire statistical model
using the ubiquitous JSON format is that we can leverage a wide
ecosystem of tools to manipulate JSON documents.</p>
<p>In particular we can use the
<a class="reference external" href="https://tools.ietf.org/html/rfc6902]">JSON-Patch</a>format (a
proposed IETF standard) to replace the signal component of the
statistical model with a new signal.</p>
<p>This new signal distribution could for example be the result of a
third-party analysis implementation such as Rivet.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_signal</span> <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span><span class="p">,</span><span class="mf">10.</span><span class="p">]</span>
<span class="n">patch</span> <span class="o">=</span> <span class="n">jsonpatch</span><span class="o">.</span><span class="n">JsonPatch</span><span class="p">([</span>
    <span class="p">{</span><span class="s1">&#39;op&#39;</span><span class="p">:</span> <span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/channels/0/samples/0/data&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">new_signal</span><span class="p">},</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">recast</span> <span class="o">=</span> <span class="n">pyhf</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">original</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
<span class="n">recast</span><span class="o">.</span><span class="n">spec</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;channels&#39;: [{&#39;name&#39;: &#39;singlechannel&#39;,
   &#39;samples&#39;: [{&#39;name&#39;: &#39;signal&#39;,
     &#39;data&#39;: [20.0, 10.0],
     &#39;modifiers&#39;: [{&#39;name&#39;: &#39;mu&#39;, &#39;type&#39;: &#39;normfactor&#39;, &#39;data&#39;: None}]},
    {&#39;name&#39;: &#39;background&#39;,
     &#39;data&#39;: [50.0, 65.0],
     &#39;modifiers&#39;: [{&#39;name&#39;: &#39;uncorr_bkguncrt&#39;,
       &#39;type&#39;: &#39;shapesys&#39;,
       &#39;data&#39;: [5.0, 3.0]}]}]}]}
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-Recasted-Result">
<h2>The Recasted Result<a class="headerlink" href="#The-Recasted-Result" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">testmus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">pyhf</span><span class="o">.</span><span class="n">runOnePoint</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">data</span> <span class="o">+</span> <span class="n">recast</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auxdata</span><span class="p">,</span> <span class="n">recast</span><span class="p">,</span> <span class="n">recast</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suggested_init</span><span class="p">(),</span> <span class="n">recast</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suggested_bounds</span><span class="p">())[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">testmus</span>
<span class="p">]</span>
<span class="n">plot_results</span><span class="p">(</span><span class="n">testmus</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/lukas/Code/pyhf/pyhf/tensor/numpy_backend.py:73: RuntimeWarning: divide by zero encountered in log
  return np.log(tensor_in)
/Users/lukas/Code/pyhf/pyhf/tensor/numpy_backend.py:98: RuntimeWarning: divide by zero encountered in log
  return np.exp(n*np.log(lam)-lam-gammaln(n+1.))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebooks_Recast_11_1.png" src="../../_images/examples_notebooks_Recast_11_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ShapeFactor.html" class="btn btn-neutral float-right" title="ShapeFactor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="binderexample/StatisticalAnalysis.html" class="btn btn-neutral" title="Binned HEP Statistical Analysis in Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Lukas Heinrich, Matthew Feickert, Giordon Stark.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.0.4',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>